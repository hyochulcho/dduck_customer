<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#F97316">
    <title>ë–¡ì§‘ ê³ ê°ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <style>
        /* ê¸°ë³¸ ë¦¬ì…‹ ë° Tailwind ëŒ€ì²´ ìŠ¤íƒ€ì¼ */
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        * { -webkit-tap-highlight-color: transparent; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #FEF3C7; padding-bottom: 80px; }
        
        /* ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ */
        .container { width: 100%; margin: 0 auto; }
        .mx-auto { margin-left: auto; margin-right: auto; }
        .max-w-4xl { max-width: 896px; }
        .p-2 { padding: 8px; }
        .p-3 { padding: 12px; }
        .p-4 { padding: 16px; }
        .p-6 { padding: 24px; }
        .px-2 { padding-left: 8px; padding-right: 8px; }
        .px-3 { padding-left: 12px; padding-right: 12px; }
        .px-4 { padding-left: 16px; padding-right: 16px; }
        .py-1 { padding-top: 4px; padding-bottom: 4px; }
        .py-2 { padding-top: 8px; padding-bottom: 8px; }
        .py-3 { padding-top: 12px; padding-bottom: 12px; }
        .py-4 { padding-top: 16px; padding-bottom: 16px; }
        .py-5 { padding-top: 20px; padding-bottom: 20px; }
        .py-8 { padding-top: 32px; padding-bottom: 32px; }
        .mb-1 { margin-bottom: 4px; }
        .mb-2 { margin-bottom: 8px; }
        .mb-3 { margin-bottom: 12px; }
        .mb-4 { margin-bottom: 16px; }
        .mt-2 { margin-top: 8px; }
        .mt-3 { margin-top: 12px; }
        .ml-2 { margin-left: 8px; }
        .mr-2 { margin-right: 8px; }
        .gap-2 { gap: 8px; }
        .gap-3 { gap: 12px; }
        .gap-4 { gap: 16px; }
        .gap-8 { gap: 8px; }
        .gap-10 { gap: 10px; }
        
        .flex { display: flex; }
        .grid { display: grid; }
        .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-cols-6 { grid-template-columns: repeat(6, 1fr); }
        .flex-1 { flex: 1; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .flex-col { flex-direction: column; }
        .overflow-x-auto { overflow-x: auto; }
        .overflow-y-auto { overflow-y: auto; }
        .overflow-hidden { overflow: hidden; }
        .whitespace-nowrap { white-space: nowrap; }
        .whitespace-pre-wrap { white-space: pre-wrap; }
        
        .text-sm { font-size: 14px; }
        .text-lg { font-size: 18px; }
        .text-xl { font-size: 20px; }
        .text-2xl { font-size: 24px; }
        .font-bold { font-weight: 700; }
        .font-semibold { font-weight: 600; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .text-left { text-align: left; }
        
        .text-white { color: white; }
        .text-gray-500 { color: #6B7280; }
        .text-gray-600 { color: #4B5563; }
        .text-gray-700 { color: #374151; }
        .text-gray-800 { color: #1F2937; }
        .text-orange-600 { color: #EA580C; }
        .text-green-600 { color: #16A34A; }
        .text-green-700 { color: #15803D; }
        .text-blue-700 { color: #1D4ED8; }
        .text-red-500 { color: #EF4444; }
        .text-red-600 { color: #DC2626; }
        
        .bg-white { background: white; }
        .bg-gray-100 { background: #F3F4F6; }
        .bg-gray-500 { background: #6B7280; }
        .bg-gray-700 { background: #374151; }
        .bg-orange-50 { background: #FFF7ED; }
        .bg-orange-500 { background: #F97316; }
        .bg-blue-50 { background: #EFF6FF; }
        .bg-blue-500 { background: #3B82F6; }
        .bg-green-50 { background: #F0FDF4; }
        .bg-green-500 { background: #22C55E; }
        .bg-red-500 { background: #EF4444; }
        .bg-yellow-50 { background: #FEFCE8; }
        
        .border { border: 1px solid #E5E7EB; }
        .border-2 { border: 2px solid #E5E7EB; }
        .border-t { border-top: 1px solid #E5E7EB; }
        .border-b { border-bottom: 1px solid #E5E7EB; }
        .border-l-4 { border-left: 4px solid; }
        .border-gray-300 { border-color: #D1D5DB; }
        .border-orange-300 { border-color: #FDBA74; }
        .border-orange-500 { border-color: #F97316; }
        .border-blue-300 { border-color: #93C5FD; }
        .border-green-300 { border-color: #86EFAC; }
        .border-red-500 { border-color: #EF4444; }
        
        .rounded { border-radius: 4px; }
        .rounded-lg { border-radius: 8px; }
        .rounded-xl { border-radius: 12px; }
        
        .shadow-md { box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); }
        .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        
        .w-full { width: 100%; }
        .w-5 { width: 20px; }
        .w-10 { width: 40px; }
        .w-20 { width: 80px; }
        .h-5 { height: 20px; }
        
        .sticky { position: sticky; }
        .top-0 { top: 0; }
        .top-16 { top: 64px; }
        .z-30 { z-index: 30; }
        .z-40 { z-index: 40; }
        
        .cursor-pointer { cursor: pointer; }
        .opacity-50 { opacity: 0.5; }
        
        /* ë²„íŠ¼ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        button { cursor: pointer; border: none; }
        
        /* íƒ­ ê´€ë ¨ */
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .nav-tab { transition: all 0.3s ease; background: transparent; }
        .nav-tab.active { background: #F97316; color: white; font-weight: 600; }
        
        /* ì…ë ¥ í•„ë“œ */
        input, select, textarea { font-size: 16px !important; border: 2px solid #D1D5DB; border-radius: 8px; padding: 12px; width: 100%; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #F97316; }
        
        /* í† ê¸€ ìŠ¤ìœ„ì¹˜ */
        .toggle-switch { width: 60px; height: 32px; background: #D1D5DB; border-radius: 16px; position: relative; cursor: pointer; transition: background 0.3s; }
        .toggle-switch.active { background: #10B981; }
        .toggle-switch::after { content: ''; position: absolute; width: 28px; height: 28px; background: white; border-radius: 50%; top: 2px; left: 2px; transition: transform 0.3s; }
        .toggle-switch.active::after { transform: translateX(28px); }
        
        /* í†µê³„ ì¹´ë“œ */
        .stat-card { background: linear-gradient(135deg, #FFF7ED 0%, #FFEDD5 100%); }
        
        /* ëª¨ë‹¬ */
        .modal { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; padding: 20px; }
        .modal.show { display: flex; }
        .modal-content { background: white; border-radius: 12px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto; }
        
        /* ë°°ì§€ */
        .badge { display: inline-block; padding: 6px 12px; border-radius: 20px; font-size: 13px; font-weight: 600; }
        .badge-success { background: #4CAF50; color: white; }
        .badge-danger { background: #f44336; color: white; }
        
        /* ë°” ì°¨íŠ¸ */
        .bar-chart { display: flex; flex-direction: column; gap: 8px; }
        .bar-item { display: flex; align-items: center; gap: 8px; }
        .bar { height: 24px; background: linear-gradient(90deg, #F97316, #FB923C); border-radius: 4px; }
        
        /* ì£¼ë¬¸ ì¹´ë“œ */
        .order-card { background: white; border: 1px solid #E5E7EB; border-radius: 12px; margin-bottom: 16px; overflow: hidden; }
        .order-card-header { background: #f5f5f5; padding: 12px 16px; border-bottom: 1px solid #E5E7EB; font-size: 14px; color: #666; display: flex; justify-content: space-between; align-items: center; }
        .order-card-body { padding: 16px; }
        
        /* ì •ë³´ ì„¹ì…˜ */
        .info-section { background: #f8fafc; border: 2px solid #e2e8f0; border-radius: 12px; padding: 16px; margin-bottom: 16px; }
        .info-section-title { font-size: 16px; font-weight: 700; color: #1e293b; margin-bottom: 16px; }
        
        /* ì²´í¬ë°•ìŠ¤ ì˜ì—­ */
        .same-as-orderer-checkbox { background: #dbeafe; border: 2px solid #3b82f6; border-radius: 8px; padding: 12px 16px; margin-bottom: 16px; display: flex; align-items: center; gap: 10px; }
        .same-as-orderer-checkbox input { width: 20px; height: 20px; }
        .same-as-orderer-checkbox label { font-weight: 600; color: #1e40af; cursor: pointer; }
        
        .disabled-input { background: #e5e7eb !important; color: #6b7280 !important; }
        
        .section-divider { border-top: 2px solid #e5e7eb; margin: 24px 0 16px 0; padding-top: 16px; }
        
        /* ë™ê¸°í™” ìƒíƒœ */
        .sync-status { position: fixed; top: 70px; right: 10px; padding: 8px 12px; border-radius: 8px; font-size: 12px; font-weight: 600; z-index: 100; }
        .sync-success { background: #d1fae5; color: #065f46; }
        .sync-error { background: #fee2e2; color: #991b1b; }
        .sync-loading { background: #e0e7ff; color: #3730a3; }
        
        /* ê³ ê° ì¹´ë“œ */
        .customer-card { background: white; border-radius: 12px; padding: 16px; margin-bottom: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); cursor: pointer; }
        .customer-card:hover { background: #FFF7ED; }
        
        /* í•„í„° ì„¹ì…˜ */
        .filter-section { background: #e3f2fd; border-radius: 12px; padding: 16px; margin-bottom: 16px; }
        
        /* ê³ ê° ì„ íƒ ì¹´ë“œ */
        .customer-select-card { background: white; border: 2px solid #e5e7eb; border-radius: 12px; padding: 12px; margin-bottom: 8px; cursor: pointer; }
        .customer-select-card.selected { background: #e8f5e9; border-color: #4CAF50; }
        
        /* í…Œì´ë¸” */
        .table-container { overflow-x: auto; }
        .order-status-table { width: 100%; border-collapse: collapse; }
        .order-status-table th { background: #374151; color: white; padding: 12px 8px; font-size: 14px; text-align: left; }
        .order-status-table td { padding: 12px 8px; font-size: 14px; border-bottom: 1px solid #E5E7EB; }
        .order-status-table tbody tr:hover { background: #FEF3C7; }
        
        /* ë©”ëª¨ì¥ ìŠ¤íƒ€ì¼ */
        .folder-card { background: white; border: 2px solid #e5e7eb; border-radius: 12px; padding: 16px; margin-bottom: 12px; cursor: pointer; transition: all 0.2s; }
        .folder-card:hover { border-color: #F97316; background: #FFF7ED; }
        .folder-card.active { border-color: #F97316; background: #FFEDD5; }
        .memo-card { background: white; border: 1px solid #e5e7eb; border-radius: 8px; padding: 12px; margin-bottom: 8px; cursor: pointer; }
        .memo-card:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .folder-icon { font-size: 24px; margin-right: 8px; }
        .memo-preview { color: #6b7280; font-size: 13px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .memo-date { color: #9ca3af; font-size: 12px; }
        .back-btn { background: #f3f4f6; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; margin-bottom: 16px; }
        .back-btn:hover { background: #e5e7eb; }
        .folder-icon-btn { padding: 12px; font-size: 24px; border: 2px solid #e5e7eb; border-radius: 8px; background: white; cursor: pointer; }
        .folder-icon-btn:hover { background: #FFF7ED; }
        .folder-icon-btn.selected { border-color: #F97316; background: #FFF7ED; }
        
        /* ê·¸ë¼ë°ì´ì…˜ ë²„íŠ¼ */
        .btn-gradient { background: linear-gradient(to right, #F97316, #EA580C); }
        
        /* ì²´í¬ë°•ìŠ¤ ì»¤ìŠ¤í…€ */
        input[type="checkbox"] { width: 20px; height: 20px; }
    </style>
</head>
<body>
    <header class="bg-white p-2 shadow-lg sticky top-0 z-30">
        <div class="flex justify-center">
            <img src="https://i.ibb.co/RTsghxnK/001-8.png" alt="ë¡œê³ " style="max-height: 50px;">
        </div>
    </header>

    <div id="syncStatus" class="sync-status" style="display:none;"></div>

    <nav class="bg-white shadow-md sticky top-16 z-40">
        <div class="flex overflow-x-auto">
            <button class="nav-tab active flex-1 py-3 px-2 text-sm whitespace-nowrap" onclick="switchTab('order', this)">ğŸ“ ì£¼ë¬¸ì…ë ¥</button>
            <button class="nav-tab flex-1 py-3 px-2 text-sm whitespace-nowrap" onclick="switchTab('customers', this)">ğŸ‘¥ ê³ ê°ê²€ìƒ‰</button>
            <button class="nav-tab flex-1 py-3 px-2 text-sm whitespace-nowrap" onclick="switchTab('delivery', this)">ğŸšš ì˜¤ëŠ˜ë°°ì†¡</button>
            <button class="nav-tab flex-1 py-3 px-2 text-sm whitespace-nowrap" onclick="switchTab('status', this)">ğŸ“‹ ì£¼ë¬¸í˜„í™©</button>
            <button class="nav-tab flex-1 py-3 px-2 text-sm whitespace-nowrap" onclick="switchTab('memo', this)">ğŸ“’ ë©”ëª¨ì¥</button>
            <button class="nav-tab flex-1 py-3 px-2 text-sm whitespace-nowrap" onclick="switchTab('message', this)">ğŸ’¬ ë¬¸ì</button>
            <button class="nav-tab flex-1 py-3 px-2 text-sm whitespace-nowrap" onclick="switchTab('stats', this)">ğŸ“Š í†µê³„</button>
            <button class="nav-tab flex-1 py-3 px-2 text-sm whitespace-nowrap" onclick="switchTab('settings', this)">âš™ï¸ ì„¤ì •</button>
        </div>
    </nav>

    <main class="container mx-auto p-4 max-w-4xl">
        <!-- ì£¼ë¬¸ ì…ë ¥ íƒ­ -->
        <div id="tab-order" class="tab-content active">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-4">
                <h2 class="text-xl font-bold text-orange-600 mb-4">ğŸ“ ìƒˆ ì£¼ë¬¸ ë“±ë¡</h2>
                
                <div class="bg-gray-100 rounded-lg p-3 mb-4">
                    ğŸ“… ì£¼ë¬¸ ì ‘ìˆ˜ì¼ì‹œ: <span id="currentTimestamp" class="font-semibold"></span>
                </div>
                
                <div class="info-section">
                    <div class="info-section-title">ğŸ‘¤ ì£¼ë¬¸ì ì •ë³´</div>
                    <div class="mb-4">
                        <label class="text-sm font-semibold text-gray-700 mb-2" style="display:block;">ì „í™”ë²ˆí˜¸ *</label>
                        <input type="tel" id="ordererPhone" style="border-color: #FDBA74;" placeholder="010-1234-5678" oninput="searchCustomer(this.value); syncIfSameAsOrderer();">
                        <div id="customerInfo" class="mt-2"></div>
                    </div>
                    <div class="mb-4">
                        <label class="text-sm font-semibold text-gray-700 mb-2" style="display:block;">ì´ë¦„ *</label>
                        <input type="text" id="ordererName" placeholder="ì£¼ë¬¸ì ì´ë¦„" oninput="syncIfSameAsOrderer()">
                    </div>
                    <div class="mb-4">
                        <label class="text-sm font-semibold text-gray-700 mb-2" style="display:block;">ì£¼ì†Œ</label>
                        <input type="text" id="ordererAddress" placeholder="ì£¼ë¬¸ì ì£¼ì†Œ" oninput="syncIfSameAsOrderer()">
                    </div>
                </div>

                <div class="info-section">
                    <div class="info-section-title">ğŸ“¦ ë°›ëŠ” ì‚¬ëŒ ì •ë³´</div>
                    <div class="same-as-orderer-checkbox">
                        <input type="checkbox" id="sameAsOrderer" onchange="toggleSameAsOrderer()">
                        <label for="sameAsOrderer">ì£¼ë¬¸ìì™€ ë™ì¼</label>
                    </div>
                    <div class="mb-4">
                        <label class="text-sm font-semibold text-gray-700 mb-2" style="display:block;">ì´ë¦„ *</label>
                        <input type="text" id="receiverName" placeholder="ë°›ëŠ” ì‚¬ëŒ ì´ë¦„">
                    </div>
                    <div class="mb-4">
                        <label class="text-sm font-semibold text-gray-700 mb-2" style="display:block;">ì „í™”ë²ˆí˜¸ *</label>
                        <input type="tel" id="receiverPhone" placeholder="010-1234-5678">
                    </div>
                    <div class="mb-4">
                        <label class="text-sm font-semibold text-gray-700 mb-2" style="display:block;">ë°°ì†¡ ì£¼ì†Œ *</label>
                        <input type="text" id="receiverAddress" placeholder="ë°°ì†¡ë°›ì„ ì£¼ì†Œ">
                    </div>
                </div>

                <div class="section-divider">
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">ğŸ“¦ ì£¼ë¬¸ ì •ë³´</h3>
                    <div class="mb-4">
                        <label class="text-sm font-semibold text-gray-700 mb-2" style="display:block;">ìœ ì…ê²½ë¡œ *</label>
                        <select id="source"></select>
                    </div>
                    <div class="mb-4">
                        <label class="text-sm font-semibold text-gray-700 mb-2" style="display:block;">ì£¼ë¬¸ë‚´ìš© *</label>
                        <select id="menu"></select>
                    </div>
                    <div class="mb-4">
                        <label class="text-sm font-semibold text-gray-700 mb-2" style="display:block;">ì£¼ë¬¸ê¸ˆì•¡ *</label>
                        <input type="number" id="amount" placeholder="ì˜ˆ: 35000">
                    </div>
                </div>

                <div class="section-divider">
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">ğŸšš ë°°ì†¡ ì •ë³´</h3>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="text-sm font-semibold text-gray-700 mb-2" style="display:block;">ë°°ì†¡ë‚ ì§œ *</label>
                            <input type="date" id="deliveryDate" style="border-color: #FDBA74;">
                        </div>
                        <div>
                            <label class="text-sm font-semibold text-gray-700 mb-2" style="display:block;">ë°°ì†¡ì‹œê°„ *</label>
                            <select id="deliveryTime" style="border-color: #FDBA74;"></select>
                        </div>
                    </div>
                </div>

                <div class="section-divider">
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">ğŸ’³ ê²°ì œ ì •ë³´</h3>
                    <div class="mb-4">
                        <label class="text-sm font-semibold text-gray-700 mb-2" style="display:block;">ê²°ì œì—¬ë¶€</label>
                        <div class="flex items-center gap-3">
                            <div class="toggle-switch active" id="paymentToggle" onclick="togglePayment()"></div>
                            <span id="paymentLabel" class="text-lg font-semibold text-green-600">ì™„ë£Œ</span>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="text-sm font-semibold text-gray-700 mb-2" style="display:block;">ê²°ì œìˆ˜ë‹¨ *</label>
                        <select id="paymentMethod"></select>
                    </div>
                    <div class="mb-4">
                        <label class="text-sm font-semibold text-gray-700 mb-2" style="display:block;">ë©”ëª¨</label>
                        <textarea id="memo" rows="3" placeholder="íŠ¹ì´ì‚¬í•­"></textarea>
                    </div>
                </div>

                <button onclick="saveOrder()" class="w-full py-5 btn-gradient text-white text-xl font-bold rounded-lg shadow-lg">âœ… ì£¼ë¬¸ ì €ì¥</button>
            </div>
        </div>

        <!-- ê³ ê° ê²€ìƒ‰ íƒ­ -->
        <div id="tab-customers" class="tab-content">
            <div class="bg-white rounded-xl shadow-lg p-4 mb-4">
                <input type="text" id="customerSearch" style="border-color: #FDBA74;" placeholder="ğŸ” ì´ë¦„ ë˜ëŠ” ì „í™”ë²ˆí˜¸" oninput="filterCustomers(this.value)">
            </div>
            <div id="customerList"></div>
        </div>

        <!-- ì˜¤ëŠ˜ ë°°ì†¡ íƒ­ -->
        <div id="tab-delivery" class="tab-content">
            <div class="bg-white rounded-xl shadow-lg p-4 mb-4">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-bold text-orange-600">ğŸ“… <span id="todayDate"></span></h2>
                    <label class="flex items-center gap-2">
                        <input type="checkbox" id="hideCompleted" onchange="renderDeliveries()">
                        <span class="text-sm font-semibold">ì™„ë£Œ ìˆ¨ê¸°ê¸°</span>
                    </label>
                </div>
            </div>
            <div id="deliveryList"></div>
        </div>

        <!-- ì£¼ë¬¸í˜„í™© íƒ­ -->
        <div id="tab-status" class="tab-content">
            <div class="bg-white rounded-xl shadow-lg p-4 mb-4">
                <h2 class="text-xl font-bold text-orange-600 mb-4">ğŸ“‹ ì£¼ë¬¸ ì¡°íšŒ</h2>
                <div class="grid grid-cols-2 gap-3 mb-3">
                    <div>
                        <label class="text-sm font-semibold mb-1" style="display:block;">ì‹œì‘</label>
                        <input type="date" id="statusStartDate">
                    </div>
                    <div>
                        <label class="text-sm font-semibold mb-1" style="display:block;">ì¢…ë£Œ</label>
                        <input type="date" id="statusEndDate">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-2">
                    <button onclick="loadOrderStatus()" class="py-3 bg-blue-500 text-white font-semibold rounded-lg">ì¡°íšŒ</button>
                    <button onclick="loadAllOrderStatus()" class="py-3 bg-gray-500 text-white font-semibold rounded-lg">ì „ì²´</button>
                </div>
            </div>
            <div id="statusSummary" class="grid grid-cols-2 gap-3 mb-4"></div>
            <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                <div class="table-container" id="statusTableContainer"></div>
            </div>
        </div>

        <!-- ë©”ëª¨ì¥ íƒ­ -->
        <div id="tab-memo" class="tab-content">
            <div id="memoFolderView">
                <div class="bg-white rounded-xl shadow-lg p-4 mb-4">
                    <div class="flex justify-between items-center">
                        <h2 class="text-xl font-bold text-orange-600">ğŸ“’ ë©”ëª¨ì¥</h2>
                        <button onclick="showAddFolderModal()" class="px-4 py-2 bg-orange-500 text-white font-semibold rounded-lg">+ í´ë” ì¶”ê°€</button>
                    </div>
                </div>
                <div id="folderList"></div>
            </div>
            
            <div id="memoDetailView" style="display:none;">
                <button onclick="backToFolders()" class="back-btn">â† í´ë” ëª©ë¡ìœ¼ë¡œ</button>
                <div class="bg-white rounded-xl shadow-lg p-4 mb-4">
                    <div class="flex justify-between items-center">
                        <h2 class="text-xl font-bold text-orange-600"><span id="currentFolderName"></span></h2>
                        <button onclick="showAddMemoModal()" class="px-4 py-2 bg-orange-500 text-white font-semibold rounded-lg">+ ë©”ëª¨ ì¶”ê°€</button>
                    </div>
                </div>
                <div id="memoList"></div>
            </div>
        </div>

        <!-- ë¬¸ì ë°œì†¡ íƒ­ -->
        <div id="tab-message" class="tab-content">
            <div class="filter-section">
                <h2 class="text-xl font-bold mb-4">ğŸ“± ë¬¸ì ë°œì†¡</h2>
                <div class="mb-3">
                    <label class="text-sm font-semibold mb-1" style="display:block;">ìœ ì…ê²½ë¡œ</label>
                    <select id="filterSource"><option value="">ì „ì²´</option></select>
                </div>
                <button onclick="applyMessageFilters()" class="w-full py-3 bg-blue-500 text-white font-semibold rounded-lg">ğŸ” í•„í„° ì ìš©</button>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-4 mb-4">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="font-bold">ì„ íƒ: <span id="selectedCount">0</span>ëª…</h3>
                    <div class="flex gap-2">
                        <button onclick="selectAllCustomers()" class="text-sm bg-green-500 text-white px-3 py-1 rounded-lg">ì „ì²´ì„ íƒ</button>
                        <button onclick="deselectAllCustomers()" class="text-sm bg-gray-500 text-white px-3 py-1 rounded-lg">í•´ì œ</button>
                    </div>
                </div>
                <div id="messageCustomerList"></div>
            </div>
            <button onclick="copyPhoneNumbers()" class="w-full py-4 bg-gray-700 text-white text-lg font-bold rounded-lg">ğŸ“‹ ì „í™”ë²ˆí˜¸ ë³µì‚¬</button>
        </div>

        <!-- í†µê³„ íƒ­ -->
        <div id="tab-stats" class="tab-content">
            <div class="grid grid-cols-2 gap-4 mb-4">
                <div class="stat-card rounded-xl shadow-lg p-4">
                    <div class="text-sm text-gray-600">ì´ ì£¼ë¬¸</div>
                    <div class="text-2xl font-bold text-orange-600" id="statOrders">0</div>
                </div>
                <div class="stat-card rounded-xl shadow-lg p-4">
                    <div class="text-sm text-gray-600">ì´ ë§¤ì¶œ</div>
                    <div class="text-2xl font-bold text-orange-600" id="statRevenue">0ì›</div>
                </div>
                <div class="stat-card rounded-xl shadow-lg p-4">
                    <div class="text-sm text-gray-600">ê²°ì œì™„ë£Œ</div>
                    <div class="text-2xl font-bold text-green-600" id="statPaid">0</div>
                </div>
                <div class="stat-card rounded-xl shadow-lg p-4">
                    <div class="text-sm text-gray-600">ë¯¸ì™„ë£Œ</div>
                    <div class="text-2xl font-bold text-red-600" id="statUnpaid">0</div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6 mb-4">
                <h3 class="text-lg font-bold mb-4">ğŸ† ì¸ê¸° ë©”ë‰´ TOP 5</h3>
                <div id="menuChart" class="bar-chart"></div>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-bold mb-4">ğŸ“Š ìœ ì…ê²½ë¡œ ë¶„ì„</h3>
                <div id="sourceChart" class="bar-chart"></div>
            </div>
        </div>

        <!-- ì„¤ì • íƒ­ -->
        <div id="tab-settings" class="tab-content">
            <div class="bg-white rounded-xl shadow-lg p-6 mb-4">
                <h3 class="text-lg font-bold mb-4">ğŸ”„ ì„œë²„ ë™ê¸°í™”</h3>
                <button onclick="syncFromServer()" class="w-full py-3 mb-2 bg-blue-500 text-white font-semibold rounded-lg">ğŸ“¥ ì„œë²„ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°</button>
                <button onclick="syncAllToServer()" class="w-full py-3 bg-green-500 text-white font-semibold rounded-lg">ğŸ“¤ ì„œë²„ë¡œ ì „ì²´ ì—…ë¡œë“œ</button>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6 mb-4">
                <h3 class="text-lg font-bold mb-4">ğŸ¡ ë©”ë‰´ ê´€ë¦¬</h3>
                <div id="menuList" class="mb-3"></div>
                <button onclick="addMenu()" class="w-full py-3 bg-orange-500 text-white font-semibold rounded-lg">+ ë©”ë‰´ ì¶”ê°€</button>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6 mb-4">
                <h3 class="text-lg font-bold mb-4">ğŸ“ ìœ ì…ê²½ë¡œ ê´€ë¦¬</h3>
                <div id="sourceList" class="mb-3"></div>
                <button onclick="addSource()" class="w-full py-3 bg-orange-500 text-white font-semibold rounded-lg">+ ê²½ë¡œ ì¶”ê°€</button>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-bold mb-4">ğŸ’¾ ë°ì´í„° ê´€ë¦¬</h3>
                <button onclick="backupData()" class="w-full py-3 mb-2 bg-green-500 text-white font-semibold rounded-lg">ğŸ“¥ ë°±ì—…</button>
                <button onclick="document.getElementById('restoreFile').click()" class="w-full py-3 mb-2 bg-blue-500 text-white font-semibold rounded-lg">ğŸ“¤ ë¶ˆëŸ¬ì˜¤ê¸°</button>
                <input type="file" id="restoreFile" accept=".json" style="display:none" onchange="restoreData(event)">
                <button onclick="deleteAllData()" class="w-full py-3 bg-red-500 text-white font-semibold rounded-lg">ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ</button>
            </div>
        </div>
    </main>

    <!-- ê³ ê° ì£¼ë¬¸ì´ë ¥ ëª¨ë‹¬ -->
    <div id="customerModal" class="modal" onclick="if(event.target===this)closeCustomerModal()">
        <div class="modal-content">
            <div class="bg-orange-500 text-white p-4 flex justify-between items-center">
                <h3 class="text-lg font-bold" id="modalCustomerName">ê³ ê° ì£¼ë¬¸ì´ë ¥</h3>
                <button onclick="closeCustomerModal()" class="text-2xl font-bold">&times;</button>
            </div>
            <div class="p-4" id="modalCustomerInfo"></div>
            <div class="p-4 border-t" id="modalOrderHistory"></div>
        </div>
    </div>

    <!-- í´ë” ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="folderModal" class="modal" onclick="if(event.target===this)closeFolderModal()">
        <div class="modal-content">
            <div class="bg-orange-500 text-white p-4 flex justify-between items-center">
                <h3 class="text-lg font-bold" id="folderModalTitle">ìƒˆ í´ë”</h3>
                <button onclick="closeFolderModal()" class="text-2xl font-bold">&times;</button>
            </div>
            <div class="p-4">
                <div class="mb-4">
                    <label class="text-sm font-semibold text-gray-700 mb-2" style="display:block;">í´ë” ì´ë¦„</label>
                    <input type="text" id="folderNameInput" placeholder="í´ë” ì´ë¦„ ì…ë ¥">
                </div>
                <div class="mb-4">
                    <label class="text-sm font-semibold text-gray-700 mb-2" style="display:block;">ì•„ì´ì½˜ ì„ íƒ</label>
                    <div class="grid grid-cols-6 gap-2" id="folderIconSelector">
                        <button type="button" onclick="selectFolderIcon('ğŸ“')" class="folder-icon-btn">ğŸ“</button>
                        <button type="button" onclick="selectFolderIcon('ğŸ“‚')" class="folder-icon-btn">ğŸ“‚</button>
                        <button type="button" onclick="selectFolderIcon('ğŸ—‚ï¸')" class="folder-icon-btn">ğŸ—‚ï¸</button>
                        <button type="button" onclick="selectFolderIcon('ğŸ“‹')" class="folder-icon-btn">ğŸ“‹</button>
                        <button type="button" onclick="selectFolderIcon('ğŸ“Œ')" class="folder-icon-btn">ğŸ“Œ</button>
                        <button type="button" onclick="selectFolderIcon('â­')" class="folder-icon-btn">â­</button>
                        <button type="button" onclick="selectFolderIcon('ğŸ’¼')" class="folder-icon-btn">ğŸ’¼</button>
                        <button type="button" onclick="selectFolderIcon('ğŸ¯')" class="folder-icon-btn">ğŸ¯</button>
                        <button type="button" onclick="selectFolderIcon('ğŸ’¡')" class="folder-icon-btn">ğŸ’¡</button>
                        <button type="button" onclick="selectFolderIcon('ğŸ”–')" class="folder-icon-btn">ğŸ”–</button>
                        <button type="button" onclick="selectFolderIcon('ğŸ“')" class="folder-icon-btn">ğŸ“</button>
                        <button type="button" onclick="selectFolderIcon('ğŸ¡')" class="folder-icon-btn">ğŸ¡</button>
                    </div>
                </div>
                <input type="hidden" id="selectedFolderIcon" value="ğŸ“">
                <input type="hidden" id="editingFolderId" value="">
                <button type="button" onclick="saveFolder()" class="w-full py-4 bg-orange-500 text-white text-lg font-bold rounded-lg">ì €ì¥</button>
            </div>
        </div>
    </div>

    <!-- ë©”ëª¨ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
    <div id="memoModal" class="modal" onclick="if(event.target===this)closeMemoModal()">
        <div class="modal-content">
            <div class="bg-orange-500 text-white p-4 flex justify-between items-center">
                <h3 class="text-lg font-bold" id="memoModalTitle">ìƒˆ ë©”ëª¨</h3>
                <button onclick="closeMemoModal()" class="text-2xl font-bold">&times;</button>
            </div>
            <div class="p-4">
                <div class="mb-4">
                    <label class="text-sm font-semibold text-gray-700 mb-2" style="display:block;">ì œëª©</label>
                    <input type="text" id="memoTitleInput" placeholder="ë©”ëª¨ ì œëª©">
                </div>
                <div class="mb-4">
                    <label class="text-sm font-semibold text-gray-700 mb-2" style="display:block;">ë‚´ìš©</label>
                    <textarea id="memoContentInput" rows="8" placeholder="ë©”ëª¨ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>
                <input type="hidden" id="editingMemoId" value="">
                <button type="button" onclick="saveMemo()" class="w-full py-4 bg-orange-500 text-white text-lg font-bold rounded-lg">ì €ì¥</button>
            </div>
        </div>
    </div>

    <!-- ë©”ëª¨ ë³´ê¸° ëª¨ë‹¬ -->
    <div id="memoViewModal" class="modal" onclick="if(event.target===this)closeMemoViewModal()">
        <div class="modal-content">
            <div class="bg-orange-500 text-white p-4 flex justify-between items-center">
                <h3 class="text-lg font-bold" id="memoViewTitle">ë©”ëª¨</h3>
                <button onclick="closeMemoViewModal()" class="text-2xl font-bold">&times;</button>
            </div>
            <div class="p-4">
                <div id="memoViewContent" class="mb-4 whitespace-pre-wrap text-gray-700"></div>
                <div id="memoViewDate" class="text-sm text-gray-500 mb-4"></div>
                <div class="grid grid-cols-2 gap-2">
                    <button type="button" onclick="editCurrentMemo()" class="py-3 bg-blue-500 text-white font-semibold rounded-lg">âœï¸ ìˆ˜ì •</button>
                    <button type="button" onclick="deleteCurrentMemo()" class="py-3 bg-red-500 text-white font-semibold rounded-lg">ğŸ—‘ï¸ ì‚­ì œ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== Google Sheets ì—°ë™ ==========
        const API_URL = 'https://script.google.com/macros/s/AKfycbw2x_5ja-iMSN4SNYTMYHLLlf8nT8DdGiaLiqoBPcXYCEXtnLEXkdJ9q8cab8iu6SgJ/exec';

        let currentStatusOrders = [];
        let filteredCustomers = [];
        let selectedCustomers = new Set();
        let currentFolderId = null;
        let currentViewingMemoId = null;

        function showSyncStatus(message, type) {
            const el = document.getElementById('syncStatus');
            el.textContent = message;
            el.className = 'sync-status sync-' + type;
            el.style.display = 'block';
            if (type !== 'loading') setTimeout(() => el.style.display = 'none', 3000);
        }

        async function loadOrdersFromServer() {
            showSyncStatus('ì„œë²„ì—ì„œ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', 'loading');
            try {
                const response = await fetch(API_URL + '?action=getOrders');
                const result = await response.json();
                if (result.success) {
                    localStorage.setItem('orders', JSON.stringify(result.orders));
                    showSyncStatus('âœ“ ë™ê¸°í™” ì™„ë£Œ!', 'success');
                    return result.orders;
                }
            } catch (error) {
                showSyncStatus('âœ— ì—°ê²° ì‹¤íŒ¨', 'error');
            }
            return [];
        }

        async function saveOrderToServer(order) {
            try {
                const response = await fetch(API_URL + '?action=saveOrder&data=' + encodeURIComponent(JSON.stringify(order)));
                const result = await response.json();
                if (result.success) showSyncStatus('âœ“ ì„œë²„ ì €ì¥ ì™„ë£Œ!', 'success');
                return result.success;
            } catch (error) {
                showSyncStatus('âœ— ì €ì¥ ì‹¤íŒ¨', 'error');
                return false;
            }
        }

        async function syncFromServer() {
            await loadOrdersFromServer();
            renderAll();
            alert('âœ“ ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!');
        }

        async function syncAllToServer() {
            const orders = getOrders();
            if (!orders.length) { alert('ì—…ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'); return; }
            showSyncStatus('ì—…ë¡œë“œ ì¤‘...', 'loading');
            let count = 0;
            for (const order of orders) {
                if (await saveOrderToServer(order)) count++;
            }
            showSyncStatus('âœ“ ' + count + 'ê±´ ì™„ë£Œ!', 'success');
            alert('âœ“ ' + count + 'ê±´ ì—…ë¡œë“œ ì™„ë£Œ!');
        }

        // ========== ê¸°ë³¸ í•¨ìˆ˜ ==========
        function getOrders() { return JSON.parse(localStorage.getItem('orders') || '[]'); }
        function getMenus() { return JSON.parse(localStorage.getItem('menus') || '[]'); }
        function getSources() { return JSON.parse(localStorage.getItem('sources') || '[]'); }
        function getDeliveryTimes() { return JSON.parse(localStorage.getItem('deliveryTimes') || '[]'); }
        function getPaymentMethods() { return JSON.parse(localStorage.getItem('paymentMethods') || '[]'); }
        function getMemoFolders() { return JSON.parse(localStorage.getItem('memoFolders') || '[]'); }
        function getMemos() { return JSON.parse(localStorage.getItem('memos') || '[]'); }

        function initializeData() {
            if (!localStorage.getItem('menus')) localStorage.setItem('menus', JSON.stringify(['ì¸ì ˆë¯¸', 'ì†¡í¸', 'ì ˆí¸', 'ê°€ë˜ë–¡', 'ê¿€ë–¡', 'ë°±ì„¤ê¸°']));
            if (!localStorage.getItem('sources')) localStorage.setItem('sources', JSON.stringify(['ì§€ì¸ì†Œê°œ', 'ë‹¹ê·¼', 'ë„¤ì´ë²„', 'ì¸ìŠ¤íƒ€ê·¸ë¨', 'ê¸°ì¡´ê³ ê°']));
            if (!localStorage.getItem('deliveryTimes')) {
                const times = [];
                for (let i = 9; i <= 21; i++) times.push(i + 'ì‹œ');
                localStorage.setItem('deliveryTimes', JSON.stringify(times));
            }
            if (!localStorage.getItem('paymentMethods')) localStorage.setItem('paymentMethods', JSON.stringify(['í˜„ê¸ˆ', 'ê³„ì¢Œì´ì²´', 'ì¹´ë“œ']));
            if (!localStorage.getItem('memoFolders')) localStorage.setItem('memoFolders', JSON.stringify([
                { id: 1, name: 'ì¼ë°˜ ë©”ëª¨', icon: 'ğŸ“' },
                { id: 2, name: 'ì¤‘ìš”', icon: 'â­' },
                { id: 3, name: 'ë ˆì‹œí”¼', icon: 'ğŸ¡' }
            ]));
            if (!localStorage.getItem('memos')) localStorage.setItem('memos', JSON.stringify([]));
        }

        function populateSelects() {
            const menus = getMenus(), sources = getSources(), times = getDeliveryTimes(), methods = getPaymentMethods();
            document.getElementById('menu').innerHTML = '<option value="">ì„ íƒ</option>' + menus.map(m => '<option value="'+m+'">'+m+'</option>').join('');
            document.getElementById('source').innerHTML = '<option value="">ì„ íƒ</option>' + sources.map(s => '<option value="'+s+'">'+s+'</option>').join('');
            document.getElementById('deliveryTime').innerHTML = '<option value="">ì„ íƒ</option>' + times.map(t => '<option value="'+t+'">'+t+'</option>').join('');
            document.getElementById('paymentMethod').innerHTML = '<option value="">ì„ íƒ</option>' + methods.map(m => '<option value="'+m+'">'+m+'</option>').join('');
            document.getElementById('filterSource').innerHTML = '<option value="">ì „ì²´</option>' + sources.map(s => '<option value="'+s+'">'+s+'</option>').join('');
            
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('deliveryDate').valueAsDate = tomorrow;
            document.getElementById('statusStartDate').valueAsDate = new Date();
            document.getElementById('statusEndDate').valueAsDate = new Date();
        }

        function updateCurrentTimestamp() {
            const now = new Date();
            const el = document.getElementById('currentTimestamp');
            if (el) el.textContent = now.toLocaleString('ko-KR');
        }

        // ========== ì²´í¬ë°•ìŠ¤ ==========
        function toggleSameAsOrderer() {
            const cb = document.getElementById('sameAsOrderer');
            const rn = document.getElementById('receiverName');
            const rp = document.getElementById('receiverPhone');
            const ra = document.getElementById('receiverAddress');
            
            if (cb.checked) {
                rn.value = document.getElementById('ordererName').value;
                rp.value = document.getElementById('ordererPhone').value;
                ra.value = document.getElementById('ordererAddress').value;
                rn.disabled = rp.disabled = ra.disabled = true;
                rn.classList.add('disabled-input');
                rp.classList.add('disabled-input');
                ra.classList.add('disabled-input');
            } else {
                rn.disabled = rp.disabled = ra.disabled = false;
                rn.classList.remove('disabled-input');
                rp.classList.remove('disabled-input');
                ra.classList.remove('disabled-input');
            }
        }

        function syncIfSameAsOrderer() {
            if (document.getElementById('sameAsOrderer').checked) {
                document.getElementById('receiverName').value = document.getElementById('ordererName').value;
                document.getElementById('receiverPhone').value = document.getElementById('ordererPhone').value;
                document.getElementById('receiverAddress').value = document.getElementById('ordererAddress').value;
            }
        }

        // ========== ê³ ê° ==========
        function generateCustomers() {
            const orders = getOrders();
            const customers = {};
            orders.forEach(o => {
                const phone = String(o.ordererPhone || o.phone || '');
                if (!phone) return;
                const name = String(o.ordererName || o.name || '');
                if (!customers[phone]) customers[phone] = { phone, name, orderCount: 0, totalAmount: 0, lastAddress: '' };
                customers[phone].orderCount++;
                customers[phone].totalAmount += Number(o.amount) || 0;
                customers[phone].lastAddress = String(o.ordererAddress || o.address || '');
            });
            return Object.values(customers);
        }

        function searchCustomer(phone) {
            const c = generateCustomers().find(c => c.phone === phone);
            const div = document.getElementById('customerInfo');
            if (phone && c) {
                div.innerHTML = '<div class="bg-blue-50 border-2" style="border-color:#93C5FD; border-radius:8px; padding:12px;"><span class="text-blue-700 font-bold">ê¸°ì¡´ ê³ ê°: '+c.name+'</span> <button onclick="fillCustomerInfo(\''+phone+'\')" style="margin-left:8px; padding:4px 12px; background:#3B82F6; color:white; border-radius:4px; font-size:14px;">ë¶ˆëŸ¬ì˜¤ê¸°</button></div>';
            } else if (phone) {
                div.innerHTML = '<div class="bg-green-50 border-2" style="border-color:#86EFAC; border-radius:8px; padding:12px;"><span class="text-green-700 font-bold">âœ¨ ì‹ ê·œ ê³ ê°</span></div>';
            } else {
                div.innerHTML = '';
            }
        }

        function fillCustomerInfo(phone) {
            const c = generateCustomers().find(c => c.phone === phone);
            if (c) {
                document.getElementById('ordererName').value = c.name || '';
                document.getElementById('ordererAddress').value = c.lastAddress || '';
                syncIfSameAsOrderer();
            }
        }

        // ========== íƒ­ ==========
        function switchTab(tab, btn) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.getElementById('tab-' + tab).classList.add('active');
            if (btn) btn.classList.add('active');
            renderAll();
        }

        function renderAll() {
            renderCustomers();
            renderDeliveries();
            renderStats();
            renderSettings();
            renderMessageTab();
            renderMemoFolders();
        }

        // ========== ê²°ì œ í† ê¸€ ==========
        function togglePayment() {
            const t = document.getElementById('paymentToggle');
            const l = document.getElementById('paymentLabel');
            t.classList.toggle('active');
            if (t.classList.contains('active')) {
                l.textContent = 'ì™„ë£Œ';
                l.className = 'text-lg font-semibold text-green-600';
            } else {
                l.textContent = 'ë¯¸ì™„ë£Œ';
                l.className = 'text-lg font-semibold text-red-600';
            }
        }

        // ========== ì£¼ë¬¸ ì €ì¥ ==========
        function saveOrder() {
            const ordererPhone = document.getElementById('ordererPhone').value;
            const ordererName = document.getElementById('ordererName').value;
            const receiverName = document.getElementById('receiverName').value;
            const receiverPhone = document.getElementById('receiverPhone').value;
            const receiverAddress = document.getElementById('receiverAddress').value;
            const menu = document.getElementById('menu').value;
            const amount = document.getElementById('amount').value;
            const deliveryDate = document.getElementById('deliveryDate').value;
            const deliveryTime = document.getElementById('deliveryTime').value;

            if (!ordererPhone || !ordererName || !receiverName || !receiverPhone || !receiverAddress || !menu || !amount || !deliveryDate || !deliveryTime) {
                alert('í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”');
                return;
            }

            const order = {
                id: Date.now(),
                orderDate: new Date().toISOString(),
                ordererName,
                ordererPhone,
                ordererAddress: document.getElementById('ordererAddress').value,
                receiverName,
                receiverPhone,
                receiverAddress,
                menu,
                amount: parseInt(amount),
                deliveryDate,
                deliveryTime,
                paymentStatus: document.getElementById('paymentToggle').classList.contains('active') ? 'ì™„ë£Œ' : 'ë¯¸ì™„ë£Œ',
                paymentMethod: document.getElementById('paymentMethod').value,
                source: document.getElementById('source').value,
                memo: document.getElementById('memo').value
            };

            const orders = getOrders();
            orders.push(order);
            localStorage.setItem('orders', JSON.stringify(orders));
            saveOrderToServer(order);

            alert('âœ… ì£¼ë¬¸ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
            clearForm();
        }

        function clearForm() {
            document.getElementById('ordererPhone').value = '';
            document.getElementById('ordererName').value = '';
            document.getElementById('ordererAddress').value = '';
            document.getElementById('receiverName').value = '';
            document.getElementById('receiverPhone').value = '';
            document.getElementById('receiverAddress').value = '';
            document.getElementById('amount').value = '';
            document.getElementById('memo').value = '';
            document.getElementById('customerInfo').innerHTML = '';
            document.getElementById('sameAsOrderer').checked = false;
            document.getElementById('receiverName').disabled = false;
            document.getElementById('receiverPhone').disabled = false;
            document.getElementById('receiverAddress').disabled = false;
            document.getElementById('receiverName').classList.remove('disabled-input');
            document.getElementById('receiverPhone').classList.remove('disabled-input');
            document.getElementById('receiverAddress').classList.remove('disabled-input');
            populateSelects();
        }

        // ========== ê³ ê° ëª©ë¡ ==========
        function renderCustomers() {
            const list = generateCustomers().sort((a, b) => b.orderCount - a.orderCount);
            document.getElementById('customerList').innerHTML = list.map(c => 
                '<div class="customer-card" onclick="showCustomerHistory(\''+c.phone+'\')"><div class="text-lg font-bold">'+(c.name||'ì´ë¦„ì—†ìŒ')+'</div><div class="text-sm text-gray-600">'+c.phone+'</div><div class="text-sm text-orange-600">ì£¼ë¬¸ '+c.orderCount+'íšŒ Â· '+c.totalAmount.toLocaleString()+'ì›</div></div>'
            ).join('') || '<div class="text-center text-gray-500 py-8">ê³ ê°ì´ ì—†ìŠµë‹ˆë‹¤</div>';
        }

        function filterCustomers(q) {
            const list = generateCustomers().filter(c => (c.name || '').includes(q) || (c.phone || '').includes(q));
            document.getElementById('customerList').innerHTML = list.map(c => 
                '<div class="customer-card" onclick="showCustomerHistory(\''+c.phone+'\')"><div class="text-lg font-bold">'+(c.name||'ì´ë¦„ì—†ìŒ')+'</div><div class="text-sm text-gray-600">'+(c.phone||'')+'</div><div class="text-sm text-orange-600">ì£¼ë¬¸ '+c.orderCount+'íšŒ</div></div>'
            ).join('') || '<div class="text-center text-gray-500 py-8">ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ</div>';
        }

        function showCustomerHistory(phone) {
            const customers = generateCustomers();
            const customer = customers.find(c => c.phone === phone);
            const orders = getOrders().filter(o => String(o.ordererPhone || o.phone) === phone);
            
            if (!customer) return;
            
            document.getElementById('modalCustomerName').textContent = (customer.name || 'ì´ë¦„ì—†ìŒ') + ' ì£¼ë¬¸ì´ë ¥';
            document.getElementById('modalCustomerInfo').innerHTML = 
                '<div class="bg-gray-100 rounded-lg p-3">' +
                '<div class="font-bold text-lg">' + (customer.name || 'ì´ë¦„ì—†ìŒ') + '</div>' +
                '<div class="text-gray-600">' + customer.phone + '</div>' +
                '<div class="text-orange-600 font-semibold">ì´ ' + customer.orderCount + 'íšŒ ì£¼ë¬¸ Â· ' + customer.totalAmount.toLocaleString() + 'ì›</div>' +
                '</div>' +
                '<button onclick="deleteCustomer(\'' + phone + '\')" class="w-full mt-3 py-2 bg-red-500 text-white font-semibold rounded-lg">ğŸ—‘ï¸ ì´ ê³ ê° ì‚­ì œ</button>';
            
            document.getElementById('modalOrderHistory').innerHTML = orders.length ? 
                orders.map(o => 
                    '<div class="border-b py-3">' +
                    '<div class="flex justify-between"><span class="font-bold">' + o.menu + '</span><span class="text-orange-600">' + Number(o.amount).toLocaleString() + 'ì›</span></div>' +
                    '<div class="text-sm text-gray-600">ë°°ì†¡: ' + (o.deliveryDate || '').split('T')[0] + ' ' + (o.deliveryTime || '') + '</div>' +
                    '<div class="text-sm"><span class="badge ' + (o.paymentStatus === 'ì™„ë£Œ' ? 'badge-success' : 'badge-danger') + '">' + o.paymentStatus + '</span></div>' +
                    (o.memo ? '<div class="text-sm text-gray-500 mt-1">ğŸ’¬ ' + o.memo + '</div>' : '') +
                    '</div>'
                ).join('') : '<div class="text-gray-500 text-center">ì£¼ë¬¸ ì´ë ¥ ì—†ìŒ</div>';
            
            document.getElementById('customerModal').classList.add('show');
        }

        function closeCustomerModal() {
            document.getElementById('customerModal').classList.remove('show');
        }

        async function deleteCustomer(phone) {
            if (!confirm('ì´ ê³ ê°ì˜ ëª¨ë“  ì£¼ë¬¸ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ë³µêµ¬ ë¶ˆê°€)')) return;
            if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            let orders = getOrders();
            const deleteOrders = orders.filter(o => String(o.ordererPhone || o.phone) === phone);
            orders = orders.filter(o => String(o.ordererPhone || o.phone) !== phone);
            localStorage.setItem('orders', JSON.stringify(orders));
            
            for (const order of deleteOrders) {
                try {
                    await fetch(API_URL + '?action=deleteOrder&id=' + order.id);
                } catch (e) {}
            }
            
            closeCustomerModal();
            renderCustomers();
            showSyncStatus('âœ“ ì‚­ì œ ì™„ë£Œ!', 'success');
        }

        // ========== ì˜¤ëŠ˜ ë°°ì†¡ ==========
        function renderDeliveries() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('todayDate').textContent = new Date().toLocaleDateString('ko-KR', { year:'numeric', month:'long', day:'numeric' });
            
            let orders = getOrders().filter(o => o.deliveryDate === today);
            const hide = document.getElementById('hideCompleted').checked;
            const done = JSON.parse(localStorage.getItem('completedOrders') || '{}');
            if (hide) orders = orders.filter(o => !done[o.id]);

            document.getElementById('deliveryList').innerHTML = orders.length ? orders.map(o => 
                '<div class="order-card '+(done[o.id]?'opacity-50':'')+'" style="'+(o.paymentStatus==='ë¯¸ì™„ë£Œ'?'border-left:4px solid #EF4444;':'')+'">'+
                '<div class="order-card-header"><span>ğŸšš '+o.deliveryTime+'</span><label class="flex items-center gap-2"><input type="checkbox" '+(done[o.id]?'checked':'')+' onchange="toggleComplete('+o.id+')"> ì™„ë£Œ</label></div>'+
                '<div class="order-card-body"><div class="flex justify-between mb-2"><span class="font-bold text-lg">'+o.menu+'</span><span class="font-bold text-orange-600">'+Number(o.amount).toLocaleString()+'ì›</span></div>'+
                '<div class="text-sm text-gray-600">ğŸ“¦ '+(o.receiverName||o.name)+' ('+(o.receiverPhone||o.phone)+')</div>'+
                '<div class="text-sm text-gray-600">ğŸ“ '+(o.receiverAddress||o.deliveryAddress)+'</div>'+
                '<div class="mt-2"><span class="badge '+(o.paymentStatus==='ì™„ë£Œ'?'badge-success':'badge-danger')+'">'+o.paymentStatus+'</span></div>'+
                (o.memo?'<div class="mt-2 bg-yellow-50 p-2 rounded-lg text-sm">ğŸ’¬ '+o.memo+'</div>':'')+
                '</div></div>'
            ).join('') : '<div class="text-center text-gray-500 py-8">ì˜¤ëŠ˜ ë°°ì†¡ ì—†ìŒ</div>';
        }

        function toggleComplete(id) {
            const done = JSON.parse(localStorage.getItem('completedOrders') || '{}');
            done[id] = !done[id];
            localStorage.setItem('completedOrders', JSON.stringify(done));
            renderDeliveries();
        }

        // ========== ì£¼ë¬¸ í˜„í™© ==========
        function loadOrderStatus() {
            const s = document.getElementById('statusStartDate').value;
            const e = document.getElementById('statusEndDate').value;
            if (!s || !e) { alert('ë‚ ì§œ ì„ íƒ'); return; }
            currentStatusOrders = getOrders().filter(o => o.deliveryDate >= s && o.deliveryDate <= e);
            renderOrderStatus();
        }

        function loadAllOrderStatus() {
            currentStatusOrders = getOrders();
            renderOrderStatus();
        }

        function renderOrderStatus() {
            const orders = currentStatusOrders;
            const total = orders.reduce((s, o) => s + (Number(o.amount)||0), 0);
            document.getElementById('statusSummary').innerHTML = 
                '<div class="stat-card rounded-xl p-3"><div class="text-sm">ì´ ì£¼ë¬¸</div><div class="text-xl font-bold text-orange-600">'+orders.length+'ê±´</div></div>'+
                '<div class="stat-card rounded-xl p-3"><div class="text-sm">ì´ ë§¤ì¶œ</div><div class="text-xl font-bold text-orange-600">'+total.toLocaleString()+'ì›</div></div>';
            
            document.getElementById('statusTableContainer').innerHTML = orders.length ? 
                '<table class="order-status-table"><thead><tr><th>ë‚ ì§œ</th><th>ê³ ê°</th><th>ë©”ë‰´</th><th>ê¸ˆì•¡</th><th>ê²°ì œ</th></tr></thead><tbody>'+
                orders.map(o => '<tr><td>'+o.deliveryDate+'</td><td>'+(o.receiverName||o.name)+'</td><td>'+o.menu+'</td><td>'+Number(o.amount).toLocaleString()+'ì›</td><td><span class="badge '+(o.paymentStatus==='ì™„ë£Œ'?'badge-success':'badge-danger')+'">'+o.paymentStatus+'</span></td></tr>').join('')+
                '</tbody></table>' : '<div class="text-center text-gray-500 py-8">ì£¼ë¬¸ ì—†ìŒ</div>';
        }

        // ========== ë©”ëª¨ì¥ ê¸°ëŠ¥ ==========
        function renderMemoFolders() {
            const folders = getMemoFolders();
            const memos = getMemos();
            
            document.getElementById('folderList').innerHTML = folders.length ? folders.map(f => {
                const memoCount = memos.filter(m => m.folderId === f.id).length;
                return '<div class="folder-card" onclick="openFolder('+f.id+')">'+
                    '<div class="flex justify-between items-center">'+
                    '<div class="flex items-center">'+
                    '<span class="folder-icon">'+f.icon+'</span>'+
                    '<div>'+
                    '<div class="font-bold text-lg">'+f.name+'</div>'+
                    '<div class="text-sm text-gray-500">ë©”ëª¨ '+memoCount+'ê°œ</div>'+
                    '</div>'+
                    '</div>'+
                    '<div class="flex gap-2">'+
                    '<button onclick="event.stopPropagation(); editFolder('+f.id+')" class="px-3 py-1 bg-blue-500 text-white text-sm rounded-lg">ìˆ˜ì •</button>'+
                    '<button onclick="event.stopPropagation(); deleteFolder('+f.id+')" class="px-3 py-1 bg-red-500 text-white text-sm rounded-lg">ì‚­ì œ</button>'+
                    '</div>'+
                    '</div>'+
                    '</div>';
            }).join('') : '<div class="text-center text-gray-500 py-8">í´ë”ê°€ ì—†ìŠµë‹ˆë‹¤. í´ë”ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”.</div>';
        }

        function openFolder(folderId) {
            currentFolderId = folderId;
            const folder = getMemoFolders().find(f => f.id === folderId);
            if (!folder) return;
            
            document.getElementById('currentFolderName').textContent = folder.icon + ' ' + folder.name;
            document.getElementById('memoFolderView').style.display = 'none';
            document.getElementById('memoDetailView').style.display = 'block';
            renderMemos();
        }

        function backToFolders() {
            currentFolderId = null;
            document.getElementById('memoFolderView').style.display = 'block';
            document.getElementById('memoDetailView').style.display = 'none';
            renderMemoFolders();
        }

        function renderMemos() {
            const memos = getMemos().filter(m => m.folderId === currentFolderId).sort((a, b) => b.updatedAt - a.updatedAt);
            
            document.getElementById('memoList').innerHTML = memos.length ? memos.map(m => {
                const date = new Date(m.updatedAt).toLocaleDateString('ko-KR');
                const preview = m.content.substring(0, 50) + (m.content.length > 50 ? '...' : '');
                return '<div class="memo-card" onclick="viewMemo('+m.id+')">'+
                    '<div class="font-bold text-lg mb-1">'+m.title+'</div>'+
                    '<div class="memo-preview">'+preview+'</div>'+
                    '<div class="memo-date mt-2">'+date+'</div>'+
                    '</div>';
            }).join('') : '<div class="text-center text-gray-500 py-8">ë©”ëª¨ê°€ ì—†ìŠµë‹ˆë‹¤. ë©”ëª¨ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”.</div>';
        }

        function showAddFolderModal() {
            document.getElementById('folderModalTitle').textContent = 'ìƒˆ í´ë”';
            document.getElementById('folderNameInput').value = '';
            document.getElementById('selectedFolderIcon').value = 'ğŸ“';
            document.getElementById('editingFolderId').value = '';
            document.querySelectorAll('.folder-icon-btn').forEach(btn => btn.classList.remove('selected'));
            document.getElementById('folderModal').classList.add('show');
        }

        function editFolder(folderId) {
            const folder = getMemoFolders().find(f => f.id === folderId);
            if (!folder) return;
            
            document.getElementById('folderModalTitle').textContent = 'í´ë” ìˆ˜ì •';
            document.getElementById('folderNameInput').value = folder.name;
            document.getElementById('selectedFolderIcon').value = folder.icon;
            document.getElementById('editingFolderId').value = folderId;
            document.querySelectorAll('.folder-icon-btn').forEach(btn => {
                if (btn.textContent.trim() === folder.icon) {
                    btn.classList.add('selected');
                } else {
                    btn.classList.remove('selected');
                }
            });
            document.getElementById('folderModal').classList.add('show');
        }

        function closeFolderModal() {
            document.getElementById('folderModal').classList.remove('show');
        }

        function selectFolderIcon(icon) {
            document.getElementById('selectedFolderIcon').value = icon;
            document.querySelectorAll('.folder-icon-btn').forEach(btn => {
                if (btn.textContent.trim() === icon) {
                    btn.classList.add('selected');
                } else {
                    btn.classList.remove('selected');
                }
            });
        }

        function saveFolder() {
            const name = document.getElementById('folderNameInput').value.trim();
            const icon = document.getElementById('selectedFolderIcon').value;
            const editingId = document.getElementById('editingFolderId').value;
            
            if (!name) { alert('í´ë” ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”'); return; }
            
            let folders = getMemoFolders();
            
            if (editingId) {
                const idx = folders.findIndex(f => f.id === parseInt(editingId));
                if (idx !== -1) {
                    folders[idx].name = name;
                    folders[idx].icon = icon;
                }
            } else {
                folders.push({
                    id: Date.now(),
                    name: name,
                    icon: icon
                });
            }
            
            localStorage.setItem('memoFolders', JSON.stringify(folders));
            closeFolderModal();
            renderMemoFolders();
            alert('âœ… í´ë”ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function deleteFolder(folderId) {
            const memos = getMemos().filter(m => m.folderId === folderId);
            if (memos.length > 0) {
                if (!confirm('ì´ í´ë”ì— '+memos.length+'ê°œì˜ ë©”ëª¨ê°€ ìˆìŠµë‹ˆë‹¤. í´ë”ì™€ í•¨ê»˜ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            } else {
                if (!confirm('ì´ í´ë”ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            }
            
            let folders = getMemoFolders().filter(f => f.id !== folderId);
            let allMemos = getMemos().filter(m => m.folderId !== folderId);
            
            localStorage.setItem('memoFolders', JSON.stringify(folders));
            localStorage.setItem('memos', JSON.stringify(allMemos));
            renderMemoFolders();
        }

        function showAddMemoModal() {
            document.getElementById('memoModalTitle').textContent = 'ìƒˆ ë©”ëª¨';
            document.getElementById('memoTitleInput').value = '';
            document.getElementById('memoContentInput').value = '';
            document.getElementById('editingMemoId').value = '';
            document.getElementById('memoModal').classList.add('show');
        }

        function closeMemoModal() {
            document.getElementById('memoModal').classList.remove('show');
        }

        function saveMemo() {
            const title = document.getElementById('memoTitleInput').value.trim();
            const content = document.getElementById('memoContentInput').value.trim();
            const editingId = document.getElementById('editingMemoId').value;
            
            if (!title) { alert('ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”'); return; }
            if (!content) { alert('ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”'); return; }
            
            let memos = getMemos();
            
            if (editingId) {
                const idx = memos.findIndex(m => m.id === parseInt(editingId));
                if (idx !== -1) {
                    memos[idx].title = title;
                    memos[idx].content = content;
                    memos[idx].updatedAt = Date.now();
                }
            } else {
                memos.push({
                    id: Date.now(),
                    folderId: currentFolderId,
                    title: title,
                    content: content,
                    createdAt: Date.now(),
                    updatedAt: Date.now()
                });
            }
            
            localStorage.setItem('memos', JSON.stringify(memos));
            closeMemoModal();
            renderMemos();
            alert('âœ… ë©”ëª¨ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function viewMemo(memoId) {
            const memo = getMemos().find(m => m.id === memoId);
            if (!memo) return;
            
            currentViewingMemoId = memoId;
            document.getElementById('memoViewTitle').textContent = memo.title;
            document.getElementById('memoViewContent').textContent = memo.content;
            document.getElementById('memoViewDate').textContent = 'ìµœì¢… ìˆ˜ì •: ' + new Date(memo.updatedAt).toLocaleString('ko-KR');
            document.getElementById('memoViewModal').classList.add('show');
        }

        function closeMemoViewModal() {
            document.getElementById('memoViewModal').classList.remove('show');
            currentViewingMemoId = null;
        }

        function editCurrentMemo() {
            const memo = getMemos().find(m => m.id === currentViewingMemoId);
            if (!memo) return;
            
            closeMemoViewModal();
            document.getElementById('memoModalTitle').textContent = 'ë©”ëª¨ ìˆ˜ì •';
            document.getElementById('memoTitleInput').value = memo.title;
            document.getElementById('memoContentInput').value = memo.content;
            document.getElementById('editingMemoId').value = memo.id;
            document.getElementById('memoModal').classList.add('show');
        }

        function deleteCurrentMemo() {
            if (!confirm('ì´ ë©”ëª¨ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            let memos = getMemos().filter(m => m.id !== currentViewingMemoId);
            localStorage.setItem('memos', JSON.stringify(memos));
            closeMemoViewModal();
            renderMemos();
        }

        // ========== í†µê³„ ==========
        function renderStats() {
            const orders = getOrders();
            const total = orders.reduce((s, o) => s + (Number(o.amount)||0), 0);
            document.getElementById('statOrders').textContent = orders.length;
            document.getElementById('statRevenue').textContent = total.toLocaleString() + 'ì›';
            document.getElementById('statPaid').textContent = orders.filter(o => o.paymentStatus === 'ì™„ë£Œ').length;
            document.getElementById('statUnpaid').textContent = orders.filter(o => o.paymentStatus === 'ë¯¸ì™„ë£Œ').length;

            const mc = {};
            orders.forEach(o => mc[o.menu] = (mc[o.menu]||0) + 1);
            const tm = Object.entries(mc).sort((a,b) => b[1]-a[1]).slice(0, 5);
            const mm = tm[0]?.[1] || 1;
            document.getElementById('menuChart').innerHTML = tm.map(([m,c]) => 
                '<div class="bar-item"><div class="w-20 text-sm">'+m+'</div><div class="flex-1"><div class="bar" style="width:'+(c/mm*100)+'%"></div></div><div class="w-10 text-right">'+c+'</div></div>'
            ).join('') || '<div class="text-gray-500">ë°ì´í„° ì—†ìŒ</div>';

            const sc = {};
            orders.forEach(o => { if(o.source) sc[o.source] = (sc[o.source]||0) + 1; });
            const ts = Object.entries(sc).sort((a,b) => b[1]-a[1]);
            const ms = ts[0]?.[1] || 1;
            document.getElementById('sourceChart').innerHTML = ts.map(([s,c]) => 
                '<div class="bar-item"><div class="w-20 text-sm">'+s+'</div><div class="flex-1"><div class="bar" style="width:'+(c/ms*100)+'%"></div></div><div class="w-10 text-right">'+c+'</div></div>'
            ).join('') || '<div class="text-gray-500">ë°ì´í„° ì—†ìŒ</div>';
        }

        // ========== ë¬¸ì ==========
        function renderMessageTab() { applyMessageFilters(); }
        
        function applyMessageFilters() {
            const src = document.getElementById('filterSource').value;
            let list = generateCustomers();
            if (src) {
                const phones = new Set(getOrders().filter(o => o.source === src).map(o => o.ordererPhone || o.phone));
                list = list.filter(c => phones.has(c.phone));
            }
            filteredCustomers = list;
            selectedCustomers.clear();
            renderMessageCustomerList();
        }

        function renderMessageCustomerList() {
            document.getElementById('messageCustomerList').innerHTML = filteredCustomers.map(c => 
                '<div class="customer-select-card '+(selectedCustomers.has(c.phone)?'selected':'')+'" onclick="toggleSelect(\''+c.phone+'\')"><input type="checkbox" '+(selectedCustomers.has(c.phone)?'checked':'')+' onclick="event.stopPropagation()"> '+c.name+' ('+c.phone+')</div>'
            ).join('') || '<div class="text-gray-500 text-center py-4">ê³ ê° ì—†ìŒ</div>';
            document.getElementById('selectedCount').textContent = selectedCustomers.size;
        }

        function toggleSelect(p) {
            if (selectedCustomers.has(p)) selectedCustomers.delete(p);
            else selectedCustomers.add(p);
            renderMessageCustomerList();
        }

        function selectAllCustomers() { filteredCustomers.forEach(c => selectedCustomers.add(c.phone)); renderMessageCustomerList(); }
        function deselectAllCustomers() { selectedCustomers.clear(); renderMessageCustomerList(); }
        
        function copyPhoneNumbers() {
            if (!selectedCustomers.size) { alert('ê³ ê°ì„ ì„ íƒí•˜ì„¸ìš”'); return; }
            navigator.clipboard.writeText(Array.from(selectedCustomers).join(',')).then(() => alert('âœ“ ë³µì‚¬ ì™„ë£Œ!'));
        }

        // ========== ì„¤ì • ==========
        function renderSettings() {
            document.getElementById('menuList').innerHTML = getMenus().map((m,i) => 
                '<div class="flex justify-between items-center p-3 bg-orange-50 rounded-lg mb-2"><span>'+m+'</span><button onclick="deleteMenu('+i+')" class="text-red-500 font-bold">ì‚­ì œ</button></div>'
            ).join('');
            document.getElementById('sourceList').innerHTML = getSources().map((s,i) => 
                '<div class="flex justify-between items-center p-3 bg-orange-50 rounded-lg mb-2"><span>'+s+'</span><button onclick="deleteSource('+i+')" class="text-red-500 font-bold">ì‚­ì œ</button></div>'
            ).join('');
        }

        function addMenu() {
            const n = prompt('ìƒˆ ë©”ë‰´:');
            if (n) { const m = getMenus(); m.push(n); localStorage.setItem('menus', JSON.stringify(m)); populateSelects(); renderSettings(); }
        }
        function deleteMenu(i) {
            if (confirm('ì‚­ì œ?')) { const m = getMenus(); m.splice(i,1); localStorage.setItem('menus', JSON.stringify(m)); populateSelects(); renderSettings(); }
        }
        function addSource() {
            const n = prompt('ìƒˆ ê²½ë¡œ:');
            if (n) { const s = getSources(); s.push(n); localStorage.setItem('sources', JSON.stringify(s)); populateSelects(); renderSettings(); }
        }
        function deleteSource(i) {
            if (confirm('ì‚­ì œ?')) { const s = getSources(); s.splice(i,1); localStorage.setItem('sources', JSON.stringify(s)); populateSelects(); renderSettings(); }
        }

        function backupData() {
            const data = { orders: getOrders(), menus: getMenus(), sources: getSources(), memoFolders: getMemoFolders(), memos: getMemos() };
            const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'ë–¡ì§‘ë°±ì—…_' + new Date().toISOString().split('T')[0] + '.json';
            a.click();
        }

        function restoreData(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(ev) {
                    try {
                        const data = JSON.parse(ev.target.result);
                        if (data.orders) localStorage.setItem('orders', JSON.stringify(data.orders));
                        if (data.menus) localStorage.setItem('menus', JSON.stringify(data.menus));
                        if (data.sources) localStorage.setItem('sources', JSON.stringify(data.sources));
                        if (data.memoFolders) localStorage.setItem('memoFolders', JSON.stringify(data.memoFolders));
                        if (data.memos) localStorage.setItem('memos', JSON.stringify(data.memos));
                        alert('âœ“ ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ!');
                        location.reload();
                    } catch(err) { alert('íŒŒì¼ ì˜¤ë¥˜'); }
                };
                reader.readAsText(file);
            }
        }

        function deleteAllData() {
            if (confirm('ì •ë§ ì‚­ì œ?') && confirm('ë³µêµ¬ ë¶ˆê°€! ì‚­ì œ?')) {
                localStorage.clear();
                alert('ì‚­ì œ ì™„ë£Œ');
                location.reload();
            }
        }

        // ========== ì´ˆê¸°í™” ==========
        initializeData();
        populateSelects();
        updateCurrentTimestamp();
        setInterval(updateCurrentTimestamp, 1000);

        loadOrdersFromServer().then(() => {
            renderAll();
        });
    </script>
</body>
</html>
